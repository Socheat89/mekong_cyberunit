# Security: Disable Directory Listing
# Options -Indexes

RewriteEngine On
RewriteBase /

# 0. FIX BAD URLS: If browser asks for /public/..., redirect to root /...
RewriteCond %{THE_REQUEST} \s/+(?:Mekong_CyberUnit/)?public/(\S*) [NC]
RewriteRule ^(?:Mekong_CyberUnit/)?public/(.*)$ /$1 [R=301,L,NE]

# Security: Block direct access to core system folders
RewriteRule ^(config|core|middleware|database|logs|vendor|modules)/(.*)$ - [F,L]

# Handle PHP files directly - Allow specific access to existing PHP files
RewriteCond %{REQUEST_FILENAME} \.php$ [NC]
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule . - [L]

# Allow access to existing files and directories (images, css, js)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule . - [L]

# Route EVERYTHING else to index.php
RewriteRule ^(.*)$ index.php [QSA,L]